from tripsy.logging_middleware import RequestLogMiddleware
from fastapi import FastAPI
from pydantic import BaseModel
from .rag_engine import retrieve_and_answer

class AskPayload(BaseModel):
    message: str

app = FastAPI()
app.add_middleware(RequestLogMiddleware)

class Query(BaseModel):
    message: str

@app.post("/ask")
async def ask(payload: AskPayload):
    answer = retrieve_and_answer(payload.message)
    return {"answer": answer}
@app.get("/health")
async def health():
    return {"status": "ok"}
